name: Auto Create PR

# This workflow automatically creates pull requests for automated changes
# Useful for scheduled maintenance, dependency updates, or automated fixes

on:
  # Run on workflow dispatch (manual trigger)
  workflow_dispatch:
    inputs:
      title:
        description: 'PR Title'
        required: true
        default: 'chore: automated updates'
      branch:
        description: 'Branch name'
        required: true
        default: 'automated-updates'
      body:
        description: 'PR Description'
        required: false
        default: 'This PR contains automated updates and fixes.'
  
  # Can also be triggered by other workflows or schedules
  # Example: Run weekly on Sunday at midnight
  # schedule:
  #   - cron: '0 0 * * 0'

permissions:
  contents: write
  pull-requests: write

jobs:
  create-pr:
    name: Create Automated PR
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: Setup pnpm
        uses: pnpm/action-setup@v4
        with:
          version: '10.25.0'
          
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'pnpm'
          
      - name: Install dependencies
        run: pnpm install --frozen-lockfile
        
      # Example automation tasks (uncomment as needed):
      
      # Update dependencies
      # - name: Update dependencies
      #   run: pnpm update
      
      # Auto-fix linting issues
      - name: Auto-fix linting
        run: pnpm lint --fix
        continue-on-error: true
      
      # Format code (if you add prettier)
      # - name: Format code
      #   run: pnpm format
      #   continue-on-error: true
      
      # Update lock file
      - name: Update lock file
        run: pnpm install --lockfile-only
        continue-on-error: true
      
      # Create Pull Request
      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v8
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "${{ github.event.inputs.title || 'chore: automated updates' }}"
          title: "${{ github.event.inputs.title || 'chore: automated updates' }}"
          body: "${{ github.event.inputs.body || 'This PR contains automated updates and fixes.\n\n### Changes\n- Auto-fixed linting issues\n- Updated lock file\n\n### Notes\n- This PR was automatically created by GitHub Actions\n- Please review the changes before merging\n- CI checks will run automatically' }}"
          branch: "${{ github.event.inputs.branch || 'automated-updates' }}"
          delete-branch: true
          labels: |
            automated
            maintenance
          draft: false
